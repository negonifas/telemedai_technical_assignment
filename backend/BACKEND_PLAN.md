# Backend Plan (Pending Tasks)

Зафиксировано после анализа ТЗ (дата: 2025-09-17).

## Цели оставшихся доработок
1. Ограничение размера загружаемого файла (≤ 10 МБ).
2. Автосоздание (seed) категорий: "Категория 1" ... "Категория 4" при пустой таблице категорий.
3. Экспорт: выводить человеко-читаемые имена категорий (одна колонка `categories` со строкой вида `Категория 1; Категория 3`).
4. Сохранение исходного порядка колонок загруженного файла и добавление в конце служебных колонок: `score`, `score_text`, `categories`.
5. (Опционально, если потребуется фронтенду) Возвращать в API помимо списка ID ещё и имена категорий (`category_names`).
6. Мини-проверка (ручной smoke-test): загрузка → выставление оценки / категорий → экспорт → проверка формата и порядка.

## Детализация шагов
### 1. Лимит размера файла
- Проверять Content-Length (если доступен) до чтения в pandas.
- Если отсутствует или граничный случай — читать первые >10 МБ и прерывать.
- Ответ 400 + сообщение о превышении лимита.

### 2. Seed категорий
- После `db.create_all()` или при первом обращении (лениво) проверить `Category.query.count() == 0`.
- Вставить четыре записи одним коммитом.

### 3. Экспорт имён категорий
- В `export_results()` формировать строку: `'; '.join([c.name for c in q.categories])`.
- Убедиться, что пустой список даёт пустую строку.

### 4. Порядок колонок
- При успешной загрузке сохранить порядок: `original_columns = df.columns.tolist()` в модульную переменную (глобально) или в простейший файл (не обязательно, достаточно в памяти до перезапуска).
- При экспорте строить список: `[...original_columns, 'score', 'score_text', 'categories']`, избегая дубликатов.
- Выбирать только реально присутствующие в `DataFrame`.

### 5. Расширение API (опционально)
- В `GET /api/questions` и `GET /api/questions/<id>` добавить поле `category_names` (список строк).

### 6. Smoke-test сценарий
1. Запуск backend.
2. Загрузка тестового файла (<10 МБ, корректный формат).
3. Запрос `/api/categories` — должны быть 4.
4. Изменение пары вопросов: PUT с `score` и `category_ids`.
5. Экспорт Excel и CSV.
6. Проверка: порядок колонок сохранён, категории именами.

## Приоритет
1 → 2 → 3 → 4 → 6 (5 только если понадобится на фронте).

## Статус (начальный)
- 1: not started
- 2: not started
- 3: not started
- 4: not started
- 5: not started (optional)
- 6: not started

---
Документ создан для использования в следующих сессиях.
